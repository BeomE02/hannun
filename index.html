<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>HANNUN - Korean Product Guide</title>
    <link rel="stylesheet" as="style" crossorigin
        href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        :root { --primary-black: #111111; --primary-white: #ffffff; --accent-gray: #777777; --light-gray: #f2f2f2; --border-color: #dddddd; --hover-color: #e8e8e8; --focus-ring: rgba(17, 17, 17, 0.15); }
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--primary-white); color: var(--primary-black); line-height: 1.5; overflow-x: hidden; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
        .splash-screen { position: fixed; inset: 0; background: var(--primary-black); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.5s ease-out; gap: 1.5rem; color: var(--primary-white); }
        .splash-screen.fade-out { opacity: 0; pointer-events: none; }
        .splash-title { font-size: 3.5rem; font-weight: 800; letter-spacing: -0.05em; opacity: 0; animation: splashFadeIn 0.8s ease-out 0.3s forwards; }
        @keyframes splashFadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .home-screen { min-height: 100vh; padding: 2.5rem 1.5rem; display: flex; flex-direction: column; align-items: center; }
        .header { width: 100%; max-width: 500px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
        .logo-image { height: 32px; vertical-align: middle; }
        .lang-btn { padding: 0.6rem 1rem; background: var(--light-gray); border: 1px solid var(--border-color); border-radius: 0; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease; box-shadow: none; display: flex; align-items: center; gap: 0.4rem; }
        
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 1rem;
            align-items: center;
            text-align: center;
            gap: 2.5rem;
            width: 100%;
            max-width: 500px;
        }

        .welcome-text h1 { font-size: clamp(2.2rem, 8vw, 3.2rem); font-weight: 800; line-height: 1.2; letter-spacing: -0.04em; margin-bottom: 0.8rem; }
        .welcome-text p { font-size: 1.15rem; color: var(--accent-gray); font-weight: 500; }
        .search-options { width: 100%; display: flex; flex-direction: column; gap: 1rem; }
        .search-option { background: var(--primary-white); border: 2px solid var(--primary-black); border-radius: 0; padding: 1.5rem; display: flex; align-items: center; gap: 1rem; cursor: pointer; transition: all 0.2s ease-out; box-shadow: 4px 4px 0px var(--primary-black); }
        .search-option:hover { transform: translate(-2px, -2px); box-shadow: 6px 6px 0px var(--primary-black); background-color: var(--light-gray); }
        .option-icon { width: 3.5rem; height: 3.5rem; color: var(--primary-black); background: var(--light-gray); border-radius: 0; display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid var(--border-color); padding: 0.5rem; }
        .option-icon svg { width: 100%; height: 100%; object-fit: contain; }
        .option-info { flex: 1; text-align: left; }
        .option-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.25rem; letter-spacing: -0.01em; }
        .option-desc { font-size: 0.9rem; color: var(--accent-gray); line-height: 1.4; font-weight: 400; }
        .page-slide-right { position: fixed; inset: 0; background: var(--primary-white); z-index: 1000; transition: transform 0.3s cubic-bezier(0.7, 0, 0.3, 1); box-shadow: none; overflow-y: auto; transform: translateX(100%); }
        .page-slide-right.active { transform: translateX(0); }
        .page-header { background: var(--primary-white); padding: 1rem 1.5rem; display: flex; align-items: center; gap: 0.8rem; border-bottom: 2px solid var(--primary-black); z-index: 100; position: sticky; top: 0; }
        .back-btn { width: 44px; height: 44px; border-radius: 0; background: var(--primary-black); color: var(--primary-white); border: none; font-size: 1.5rem; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease-out; box-shadow: none; }
        .header-logo { flex: 1; text-align: center; margin-right: 44px; cursor: pointer; transition: opacity 0.2s; }
        .header-logo:hover { opacity: 0.7; }
        
        .search-bar-container { flex: 1; display: flex; gap: 0.5rem; }
        .search-input { flex: 1; padding: 0.8rem 1.2rem; border: 2px solid var(--primary-black); border-radius: 0; background: var(--light-gray); font-size: 1rem; outline: none; transition: all 0.2s ease-out; box-shadow: inset 2px 2px 0px rgba(0, 0, 0, 0.1); }
        .search-submit-btn { width: 44px; height: 44px; border: 2px solid var(--primary-black); background: var(--primary-black); color: var(--primary-white); cursor: pointer; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }

        .results-container { padding: 0.5rem 1.5rem; }
        .result-card { background: transparent; border-bottom: 1px solid var(--border-color); padding: 1rem 0.5rem; cursor: pointer; transition: background-color 0.15s ease-out; }
        .result-card:hover { background-color: var(--light-gray); }
        .result-name { font-size: 1.05rem; font-weight: 600; margin-bottom: 0.2rem; }
        .result-desc { font-size: 0.85rem; color: var(--accent-gray); font-weight: 400; }
        .detail-hero { padding: 2rem 1.5rem; background: var(--primary-white); border-bottom: 2px solid var(--primary-black); }
        .detail-title { font-size: 2.2rem; font-weight: 800; letter-spacing: -0.03em; margin-bottom: 0.5rem; }
        .detail-subtitle { font-size: 1rem; color: var(--accent-gray); margin-bottom: 1.5rem; font-weight: 500; }
        .info-grid { display: flex; flex-direction: column; gap: 0; margin: 1.5rem 0; border-top: 1px solid var(--border-color); }
        .info-item { background: transparent; padding: 0.9rem 0.25rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .info-label { font-size: 0.9rem; color: var(--accent-gray); font-weight: 500; flex-shrink: 0; padding-right: 1rem; }
        .info-value {
            font-size: 0.95rem;
            font-weight: 600;
            text-align: right;
            color: var(--primary-black);
            word-break: break-all;
            width: 40%;
        }
        .scanner-modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); z-index: 3000; display: none; align-items: center; justify-content: center; padding: 1rem; }
        .scanner-modal.active { display: flex; }
        .barcode-modal-content { background: var(--primary-white); border-radius: 0; width: 100%; max-width: 500px; margin: 0 auto; overflow: hidden; display: flex; flex-direction: column; border: 2px solid var(--primary-black); box-shadow: 6px 6px 0px rgba(0, 0, 0, 0.2); }
        .barcode-header { background: var(--primary-black); padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; color: var(--primary-white); }
        .close-scan-btn { width: 36px; height: 36px; border-radius: 0; background: rgba(255, 255, 255, 0.2); border: none; color: var(--primary-white); font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center; }
        .scan-title { font-size: 1.1rem; font-weight: 700; flex: 1; text-align: center; margin-right: 2.25rem; }
        .scanner-container { position: relative; background: #000; height: 300px; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        #scanner-viewport { width: 100%; height: 100%; position: relative; }
        #scanner-viewport video, #scanner-viewport canvas { width: 100%; height: 100%; object-fit: cover; position: absolute; top: 0; left: 0; }
        .scan-overlay { position: absolute; inset: 0; pointer-events: none; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .scan-guide { width: 250px; height: 100px; position: relative; }
        .scan-corners { position: absolute; top: 0; left: 0; right: 0; bottom: 0; }
        .corner { position: absolute; width: 20px; height: 20px; border: 3px solid #00ff00; }
        .corner.top-left { top: 0; left: 0; border-right: none; border-bottom: none; }
        .corner.top-right { top: 0; right: 0; border-left: none; border-bottom: none; }
        .corner.bottom-left { bottom: 0; left: 0; border-right: none; border-top: none; }
        .corner.bottom-right { bottom: 0; right: 0; border-left: none; border-top: none; }
        .scan-line { position: absolute; top: 50%; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #00ff00, transparent); animation: scan 2s linear infinite; }
        @keyframes scan { 0% { transform: translateY(-50px); } 100% { transform: translateY(50px); } }
        .scan-instruction { position: absolute; bottom: 20px; left: 0; right: 0; text-align: center; color: white; font-size: 14px; font-weight: 500; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
        .scan-result { background: var(--light-gray); padding: 30px; text-align: center; display: none; }
        .scan-result.active { display: block; }
        .result-icon { font-size: 48px; margin-bottom: 16px; }
        .barcode-number { font-size: 18px; font-weight: 700; color: #2D3436; margin-bottom: 8px; font-family: monospace; }
        .product-found { font-size: 16px; color: #5B5FDE; font-weight: 600; margin-bottom: 20px; }
        .scan-again-btn { padding: 10px 24px; background: var(--primary-black); color: white; border: none; border-radius: 0; font-size: 14px; font-weight: 600; cursor: pointer; }
        .manual-input { padding: 1.5rem; background: var(--light-gray); border-top: 1px solid var(--border-color); }
        .manual-text { font-size: 12px; color: var(--accent-gray); text-align: center; margin-bottom: 12px; }
        .barcode-input { width: 100%; padding: 0.8rem 1rem; border: 2px solid var(--primary-black); border-radius: 0; font-size: 1rem; text-align: center; margin-bottom: 0.8rem; outline: none; background-color: var(--primary-white); transition: all 0.2s ease-out; box-shadow: inset 2px 2px 0px rgba(0, 0, 0, 0.1); font-family: monospace; }
        .barcode-input:focus { border-color: #5B5FDE; }
        .search-barcode-btn { width: 100%; padding: 0.9rem; background: var(--primary-black); color: var(--primary-white); border: 2px solid var(--primary-black); border-radius: 0; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s ease-out; box-shadow: 3px 3px 0px rgba(0, 0, 0, 0.2); }
        .loading { text-align: center; padding: 3rem; color: var(--accent-gray); font-weight: 500; font-size: 1rem; }
        .spinner { width: 36px; height: 36px; border: 3px solid var(--border-color); border-top-color: var(--primary-black); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .toast { position: fixed; bottom: 2.5rem; left: 50%; transform: translateX(-50%) translateY(100px); background: var(--primary-black); color: var(--primary-white); padding: 0.8rem 1.2rem; border-radius: 0; font-size: 0.9rem; z-index: 5000; opacity: 0; transition: all 0.3s ease-out; box-shadow: 4px 4px 0px rgba(0, 0, 0, 0.2); }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
        .no-results { text-align: center; padding: 4rem 1.5rem; color: var(--accent-gray); font-weight: 500; font-size: 1rem; }
        @media (max-width: 600px) { input[type="text"], input[type="number"] { font-size: 16px; } }
    </style>
</head>

<body>
    <div class="splash-screen" id="splash"> <div class="splash-title">HANNUN</div> </div>
    <main class="home-screen" id="home"> 
        <header class="header"> 
            <div class="logo"> 
                <img src="logo.jpeg" alt="HANNUN Logo" class="logo-image">
            </div> 
            <button class="lang-btn" onclick="toggleLanguage()"> <span id="langFlag">ğŸ‡°ğŸ‡·</span> <span id="langCode">KO</span> </button> 
        </header> 
        <div class="main-content"> <div class="welcome-text"> <h1 id="appTitle">í•œêµ­ ì œí’ˆì„<br>ì‰½ê²Œ ì°¾ì•„ë³´ì„¸ìš”</h1> <p id="appSubtitle">ê²€ìƒ‰ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”</p> </div> <div class="search-options"> <div class="search-option" onclick="showPage('searchResults')"> <div class="option-icon"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /> </svg> </div> <div class="option-info"> <h3 class="option-title" id="searchByName">ìƒí’ˆëª… ê²€ìƒ‰</h3> <p class="option-desc" id="searchByNameDesc">ì´ë¦„ì´ë‚˜ ë¸Œëœë“œë¡œ ì œí’ˆ ì°¾ê¸°</p> </div> </div> <div class="search-option" onclick="openBarcodeScanner()"> <div class="option-icon"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 4.5A.75.75 0 0 1 4.5 3.75h15a.75.75 0 0 1 .75.75v15a.75.75 0 0 1-.75.75h-15a.75.75 0 0 1-.75-.75v-15ZM8.25 9v6m3-6v6m3-6v6m3-6v6" /> </svg> </div> <div class="option-info"> <h3 class="option-title" id="scanBarcode">ë°”ì½”ë“œ ìŠ¤ìº”</h3> <p class="option-desc" id="scanBarcodeDesc">ë°”ì½”ë“œë¡œ ì •í™•í•˜ê²Œ ì œí’ˆ ì°¾ê¸°</p> </div> </div> </div> </div> </main>
    <div class="page-slide-right" id="searchResults"> 
        <div class="page-header"> 
            <button class="back-btn" onclick="goBack()">â†</button> 
            <div class="search-bar-container">
                <input type="text" class="search-input" id="searchInput" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”...">
                <button class="search-submit-btn" id="searchBtn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                    </svg>
                </button>
            </div>
        </div> 
        <div class="results-container" id="resultsContainer"></div> 
    </div>
    <div class="page-slide-right" id="detail"> 
        <div class="page-header"> 
            <button class="back-btn" onclick="goBack()">â†</button> 
            <div class="header-logo" onclick="goToHome()">
                <img src="logo.jpeg" alt="HANNUN Logo" class="logo-image">
            </div> 
        </div> 
        <div id="detailPageContent"></div> 
    </div>
    <div class="scanner-modal" id="scannerModal"> 
        <div class="barcode-modal-content"> 
            <div class="barcode-header"> 
                <h3 class="scan-title" id="barcodeScanTitle">ë°”ì½”ë“œ ìŠ¤ìºë„ˆ</h3> 
                <button class="close-scan-btn" onclick="closeScanner()">Ã—</button> 
            </div> 
            <div class="scanner-container" id="scanner-container"> 
                <div id="scanner-viewport">
                    <div class="scan-overlay">
                        <div class="scan-guide">
                            <div class="scan-corners">
                                <div class="corner top-left"></div>
                                <div class="corner top-right"></div>
                                <div class="corner bottom-left"></div>
                                <div class="corner bottom-right"></div>
                            </div>
                            <div class="scan-line"></div>
                        </div>
                        <div class="scan-instruction" id="scanInstruction">ë°”ì½”ë“œë¥¼ í™”ë©´ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”</div>
                    </div>
                </div>
                <div class="scan-result" id="scanResult">
                    <div class="result-icon">âœ…</div>
                    <div class="barcode-number" id="barcodeNumber"></div>
                    <div class="product-found" id="productFound"></div>
                    <button class="scan-again-btn" id="scanAgainBtn" onclick="restartScanning()">ë‹¤ì‹œ ìŠ¤ìº”</button>
                </div>
            </div> 
            <div class="manual-input"> 
                <div class="manual-text" id="manualInputText">ë˜ëŠ” ë°”ì½”ë“œ ë²ˆí˜¸ ì§ì ‘ ì…ë ¥</div>
                <input type="text" class="barcode-input" id="manualBarcode" placeholder="8801234567890">
                <button class="search-barcode-btn" id="searchBarcodeBtn" onclick="searchByManualBarcode()">ê²€ìƒ‰</button> 
            </div> 
        </div> 
    </div>
    <div class="toast" id="toast"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    <script>
        // --- API & ì„¤ì • ---
        const FOOD_API_KEY = 'c320de96f22d4183bd13';
        const FOOD_API_BASE = 'https://openapi.foodsafetykorea.go.kr/api';
        const SERVICE_ID = 'C005';
        const TRANSLATE_API_KEY = 'AIzaSyArr1P7f6JuAL8Xz8ECiHi8WkfbNRn4Z7I';
        const GEMINI_API_KEY = 'AIzaSyDrsbT0bzRyi1WOA3byzJI8VOIY2NpYa6Y';
        const PROXY_URL = 'https://api.allorigins.win/raw?url=';

        // --- ì „ì—­ ë³€ìˆ˜ ---
        let currentLang = 'ko';
        let searchCache = null;
        let pageHistory = ['home'];
        let isTranslatingCache = false;

        // --- ë‹¤êµ­ì–´ í…ìŠ¤íŠ¸ ---
        const translations = {
            ko: { 
                appTitle: 'í•œêµ­ ì œí’ˆì„<br>ì‰½ê²Œ ì°¾ì•„ë³´ì„¸ìš”', 
                appSubtitle: 'ê²€ìƒ‰ ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”', 
                searchByName: 'ìƒí’ˆëª… ê²€ìƒ‰', 
                searchByNameDesc: 'ì´ë¦„ì´ë‚˜ ë¸Œëœë“œë¡œ ì œí’ˆ ì°¾ê¸°', 
                scanBarcode: 'ë°”ì½”ë“œ ìŠ¤ìº”', 
                scanBarcodeDesc: 'ë°”ì½”ë“œë¡œ ì •í™•í•˜ê²Œ ì œí’ˆ ì°¾ê¸°', 
                searchPlaceholder: 'ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”...', 
                productDetail: 'ìƒí’ˆ ìƒì„¸ ì •ë³´', 
                manufacturer: 'ì œì¡°ì‚¬', 
                expiry: 'ì†Œë¹„ê¸°í•œ', 
                barcode: 'ë°”ì½”ë“œ', 
                reportNumber: 'í’ˆëª©ë³´ê³ ë²ˆí˜¸', 
                searching: 'ê²€ìƒ‰ ì¤‘...', 
                noResults: 'ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤', 
                loadingInfo: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...', 
                errorLoading: 'ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ', 
                barcodeTitle: 'ë°”ì½”ë“œ ìŠ¤ìºë„ˆ', 
                search: 'ê²€ìƒ‰', 
                product_found: 'ìƒí’ˆì„ ì°¾ì•˜ìŠµë‹ˆë‹¤!', 
                product_not_found: 'ìƒí’ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 
                camera_error: 'ì¹´ë©”ë¼ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 
                invalid_barcode: 'ìœ íš¨í•œ ë°”ì½”ë“œ ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 
                translation_needed: 'ë²ˆì—­ì„ ìœ„í•´ API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.',
                scanInstruction: 'ë°”ì½”ë“œë¥¼ í™”ë©´ ì¤‘ì•™ì— ë§ì¶°ì£¼ì„¸ìš”',
                manualInputText: 'ë˜ëŠ” ë°”ì½”ë“œ ë²ˆí˜¸ ì§ì ‘ ì…ë ¥',
                scanAgain: 'ë‹¤ì‹œ ìŠ¤ìº”',
                searching_product: 'ì œí’ˆ ê²€ìƒ‰ ì¤‘...'
            },
            en: { 
                appTitle: 'Find Korean<br>Products Easily', 
                appSubtitle: 'Choose your search method', 
                searchByName: 'Search by Name', 
                searchByNameDesc: 'Find products using their name', 
                scanBarcode: 'Scan Barcode', 
                scanBarcodeDesc: 'Find products with their barcode', 
                searchPlaceholder: 'Enter product name...', 
                productDetail: 'Product Details', 
                manufacturer: 'Manufacturer', 
                expiry: 'Shelf Life', 
                barcode: 'Barcode', 
                reportNumber: 'Report No.', 
                searching: 'Searching...', 
                noResults: 'No search results found', 
                loadingInfo: 'Loading information...', 
                errorLoading: 'Error loading details', 
                barcodeTitle: 'Barcode Scanner', 
                search: 'Search', 
                product_found: 'Product Found!', 
                product_not_found: 'Product not found.', 
                camera_error: 'Could not access camera.', 
                invalid_barcode: 'Please enter a valid barcode.',
                translation_needed: 'API key is required for translation.',
                scanInstruction: 'Align barcode to center of screen',
                manualInputText: 'Or enter barcode number manually',
                scanAgain: 'Scan Again',
                searching_product: 'Searching product...'
            },
            ja: { 
                appTitle: 'éŸ“å›½è£½å“ã‚’<br>ç°¡å˜ã«è¦‹ã¤ã‘ã‚ˆã†', 
                appSubtitle: 'æ¤œç´¢æ–¹æ³•ã‚’é¸ã‚“ã§ãã ã•ã„', 
                searchByName: 'å•†å“åã§æ¤œç´¢', 
                searchByNameDesc: 'å•†å“åã§è£½å“ã‚’æ¤œç´¢', 
                scanBarcode: 'ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ã‚¹ã‚­ãƒ£ãƒ³', 
                scanBarcodeDesc: 'ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã§è£½å“ã‚’æ¤œç´¢', 
                searchPlaceholder: 'å•†å“åã‚’å…¥åŠ›...', 
                productDetail: 'å•†å“è©³ç´°', 
                manufacturer: 'è£½é€ ç¤¾', 
                expiry: 'æ¶ˆè²»æœŸé™', 
                barcode: 'ãƒãƒ¼ã‚³ãƒ¼ãƒ‰', 
                reportNumber: 'å“ç›®å ±å‘Šç•ªå·', 
                searching: 'æ¤œç´¢ä¸­...', 
                noResults: 'æ¤œç´¢çµæœãŒã‚ã‚Šã¾ã›ã‚“', 
                loadingInfo: 'æƒ…å ±ã‚’èª­ã¿è¾¼ã¿ä¸­...', 
                errorLoading: 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ', 
                barcodeTitle: 'ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚¹ã‚­ãƒ£ãƒŠãƒ¼', 
                search: 'æ¤œç´¢', 
                product_found: 'è£½å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸï¼', 
                product_not_found: 'è£½å“ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 
                camera_error: 'ã‚«ãƒ¡ãƒ©ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“', 
                invalid_barcode: 'æœ‰åŠ¹ãªãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                translation_needed: 'ç¿»è¨³æ©Ÿèƒ½ã«ã¯APIã‚­ãƒ¼ãŒå¿…è¦ã§ã™',
                scanInstruction: 'ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ç”»é¢ä¸­å¤®ã«åˆã‚ã›ã¦ãã ã•ã„',
                manualInputText: 'ã¾ãŸã¯ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ç•ªå·ã‚’ç›´æ¥å…¥åŠ›',
                scanAgain: 'ã‚‚ã†ä¸€åº¦ã‚¹ã‚­ãƒ£ãƒ³',
                searching_product: 'è£½å“æ¤œç´¢ä¸­...'
            }
        };
        const getText = (key) => translations[currentLang][key] || key;

        // --- ì´ˆê¸°í™” ë° UI ì´ë²¤íŠ¸ ---
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => { document.getElementById('splash').classList.add('fade-out'); }, 1500);
            fetchAllProducts();

            let searchTimeout;
            const searchInput = document.getElementById('searchInput');
            const searchBtn = document.getElementById('searchBtn');

            const performSearch = () => {
                clearTimeout(searchTimeout);
                const query = searchInput.value.trim();
                if (query.length > 0) {
                    searchProducts(query);
                }
            };
